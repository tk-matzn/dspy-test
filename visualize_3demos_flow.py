#!/usr/bin/env python3
"""
sample_program.py ã®3ã¤ã®ãƒ‡ãƒ¢ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæµã‚Œã‚’å¯è¦–åŒ–
"""

import os
import dspy
from dotenv import load_dotenv

load_dotenv()

# è¨­å®š
azure_key = os.getenv("AZURE_OPENAI_API_KEY")
azure_endpoint = os.getenv("AZURE_OPENAI_ENDPOINT")

if azure_key and azure_endpoint:
    dspy.configure(lm=dspy.LM(
        model=f"azure/gpt-35-turbo",
        api_key=azure_key,
        api_base=azure_endpoint,
        api_version="2024-02-15-preview",
        max_tokens=200
    ))

print("=" * 80)
print("sample_program.py ã®3ã¤ã®ãƒ‡ãƒ¢ - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæµã‚Œã®å¯è¦–åŒ–")
print("=" * 80)

# ========== ãƒ‡ãƒ¢ 1: ã‚·ãƒ³ãƒ—ãƒ«ãªPredict ==========
print("\n" + "â–¶" * 40)
print("ãƒ‡ãƒ¢ 1ï¸âƒ£ : ã‚·ãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¢")
print("â–¶" * 40)

simple_flow = """
ã€ã‚·ãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¢ã®æ§‹æˆã€‘

ã‚³ãƒ¼ãƒ‰:
  qa = dspy.Predict("question -> answer")
  result = qa(question="Pythonã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ")

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæµã‚Œ:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å…¥åŠ›                                           â”‚
  â”‚ question = "Pythonã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ"              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Step 1: Signatureè§£æ                        â”‚
  â”‚ "question -> answer"                          â”‚
  â”‚ â€¢ å…¥åŠ›: question                              â”‚
  â”‚ â€¢ å‡ºåŠ›: answer                                â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Step 2: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰                        â”‚
  â”‚                                               â”‚
  â”‚ [ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ]                          â”‚
  â”‚ You are an expert at answering questions      â”‚
  â”‚ in a clear, concise manner...                â”‚
  â”‚                                               â”‚
  â”‚ [ã‚¿ã‚¹ã‚¯æŒ‡ç¤º]                                  â”‚
  â”‚ Given the fields `question`, produce          â”‚
  â”‚ the fields `answer`.                          â”‚
  â”‚                                               â”‚
  â”‚ [å½¢å¼]                                        â”‚
  â”‚ Question: ${question}                         â”‚
  â”‚ Answer: ${answer}                             â”‚
  â”‚                                               â”‚
  â”‚ [å®Ÿéš›ã®å…¥åŠ›]                                  â”‚
  â”‚ Question: Pythonã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ              â”‚
  â”‚ Answer:                                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Step 3: Azure OpenAI APIå‘¼ã³å‡ºã—              â”‚
  â”‚ â€¢ å®Œå…¨ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é€ä¿¡                       â”‚
  â”‚ â€¢ max_tokens=200ã§è¨­å®š                       â”‚
  â”‚ â€¢ temperature=1ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰                 â”‚
  â”‚                                               â”‚
  â”‚ [APIå‘¼ã³å‡ºã— 1å›]                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Step 4: LLMå‡¦ç†                              â”‚
  â”‚ â€¢ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ãƒˆãƒ¼ã‚¯ãƒ³åŒ–                      â”‚
  â”‚ â€¢ ãƒˆãƒ¼ã‚¯ãƒ³ã‚·ãƒ¼ã‚±ãƒ³ã‚¹äºˆæ¸¬                      â”‚
  â”‚ â€¢ ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ                               â”‚
  â”‚   "Python ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®..."            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Step 5: å¿œç­”è§£æ                             â”‚
  â”‚ Answer: ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰æŠ½å‡º                    â”‚
  â”‚ "Python ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®..."              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å‡ºåŠ›                                          â”‚
  â”‚ Prediction(answer="Python ã¯...")             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š çµ±è¨ˆ:
  â€¢ APIå‘¼ã³å‡ºã—æ•°: 1å›
  â€¢ Signatureå€‹æ•°: 1å€‹
  â€¢ å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—: 5æ®µéš
  â€¢ è¤‡é›‘åº¦: â­ (æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«)
"""

print(simple_flow)

# ========== ãƒ‡ãƒ¢ 2: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ ==========
print("\n" + "â–¶" * 40)
print("ãƒ‡ãƒ¢ 2ï¸âƒ£ : ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¢")
print("â–¶" * 40)

pipeline_flow = """
ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¢ã®æ§‹æˆã€‘

ã‚³ãƒ¼ãƒ‰:
  class SimplePipeline(dspy.Module):
      def __init__(self):
          self.extract_points = dspy.Predict("question -> key_points")
          self.generate_answer = dspy.Predict("key_points -> answer")
      
      def forward(self, question):
          points = self.extract_points(question=question)
          result = self.generate_answer(key_points=points.key_points)
          return result

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæµã‚Œï¼ˆè¤‡æ•°ã‚¹ãƒ†ãƒƒãƒ—ï¼‰:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å…¥åŠ›                                           â”‚
  â”‚ question = "æ—¥æœ¬ã®é¦–éƒ½ã¯ï¼Ÿãã®ç‰¹å¾´ã¯ï¼Ÿ"        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
  â”Œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”
  â”‚ ã€ã‚¹ãƒ†ãƒƒãƒ—1ã€‘ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆæŠ½å‡º                 â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Signature: "question -> key_points"           â”‚
  â”‚                                               â”‚
  â”‚ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:                                   â”‚
  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
  â”‚ [ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ]                          â”‚
  â”‚ You are an expert...                         â”‚
  â”‚                                               â”‚
  â”‚ [ã‚¿ã‚¹ã‚¯]                                      â”‚
  â”‚ Given question, produce key_points           â”‚
  â”‚                                               â”‚
  â”‚ [å½¢å¼]                                        â”‚
  â”‚ Question: [å…¥åŠ›]                             â”‚
  â”‚ KeyPoints: [æŠ½å‡ºçµæœ]                        â”‚
  â”‚                                               â”‚
  â”‚ [å®Ÿéš›ã®å…¥åŠ›]                                  â”‚
  â”‚ Question: æ—¥æœ¬ã®é¦–éƒ½ã¯ï¼Ÿãã®ç‰¹å¾´ã¯ï¼Ÿ         â”‚
  â”‚ KeyPoints:                                   â”‚
  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
  â”‚                                               â”‚
  â”‚ [APIå‘¼ã³å‡ºã— 1/2]                            â”‚
  â”‚ å‡ºåŠ›: "æ±äº¬ã€çµŒæ¸ˆä¸­å¿ƒã€æ–‡åŒ–..."               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ä¸­é–“çµæœã®ä¿å­˜                                â”‚
  â”‚ key_points = "æ±äº¬ã€çµŒæ¸ˆä¸­å¿ƒã€æ–‡åŒ–..."        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
  â”Œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”
  â”‚ ã€ã‚¹ãƒ†ãƒƒãƒ—2ã€‘å›ç­”ç”Ÿæˆ                         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Signature: "key_points -> answer"             â”‚
  â”‚                                               â”‚
  â”‚ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:                                   â”‚
  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
  â”‚ [ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ]                          â”‚
  â”‚ You are an expert...                         â”‚
  â”‚                                               â”‚
  â”‚ [ã‚¿ã‚¹ã‚¯]                                      â”‚
  â”‚ Given key_points, produce answer             â”‚
  â”‚                                               â”‚
  â”‚ [å½¢å¼]                                        â”‚
  â”‚ KeyPoints: [å‰ã‚¹ãƒ†ãƒƒãƒ—ã®å‡ºåŠ›]                â”‚
  â”‚ Answer: [æœ€çµ‚å›ç­”]                           â”‚
  â”‚                                               â”‚
  â”‚ [å®Ÿéš›ã®å…¥åŠ›]                                  â”‚
  â”‚ KeyPoints: æ±äº¬ã€çµŒæ¸ˆä¸­å¿ƒã€æ–‡åŒ–...           â”‚
  â”‚ Answer:                                       â”‚
  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
  â”‚                                               â”‚
  â”‚ [APIå‘¼ã³å‡ºã— 2/2]                            â”‚
  â”‚ å‡ºåŠ›: "æ±äº¬ã¯æ—¥æœ¬ã®é¦–éƒ½ã§..."                â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æœ€çµ‚å‡ºåŠ›                                       â”‚
  â”‚ Prediction(                                   â”‚
  â”‚   question="...",                             â”‚
  â”‚   key_points="...",                           â”‚
  â”‚   answer="..."                                â”‚
  â”‚ )                                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š çµ±è¨ˆ:
  â€¢ APIå‘¼ã³å‡ºã—æ•°: 2å›
  â€¢ Signatureå€‹æ•°: 2å€‹
  â€¢ å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—: 2ã¤ã®ç‹¬ç«‹ã—ãŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ãƒ†ãƒƒãƒ—
  â€¢ è¤‡é›‘åº¦: â­â­â­ (ä¸­ç¨‹åº¦)
  â€¢ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼: ç·šå½¢ï¼ˆStep1ã®å‡ºåŠ› â†’ Step2ã®å…¥åŠ›ï¼‰
"""

print(pipeline_flow)

# ========== ãƒ‡ãƒ¢ 3: æœ€é©åŒ–ãƒ‡ãƒ¢ ==========
print("\n" + "â–¶" * 40)
print("ãƒ‡ãƒ¢ 3ï¸âƒ£ : æœ€é©åŒ–ãƒ‡ãƒ¢")
print("â–¶" * 40)

optimization_flow = """
ã€æœ€é©åŒ–ãƒ‡ãƒ¢ã®æ§‹æˆã€‘

ã‚³ãƒ¼ãƒ‰:
  trainset = [
      dspy.Example(question="2+2ã¯?", answer="4"),
      dspy.Example(question="3Ã—5ã¯?", answer="15"),
  ]
  program = dspy.Predict("question -> answer")
  
  # å®Ÿéš›ã®æœ€é©åŒ–ã¯BootstrapFewShotç­‰ã§å®Ÿè¡Œ
  optimizer = BootstrapFewShot(metric=accuracy)
  optimized_program = optimizer.compile(program, trainset)

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæµã‚Œï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ•ã‚§ãƒ¼ã‚º1: åˆæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚ åˆæœŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆæœ€é©åŒ–å‰ï¼‰:                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ You are an expert...                        â”‚   â”‚
â”‚ â”‚                                             â”‚   â”‚
â”‚ â”‚ Question: ${question}                       â”‚   â”‚
â”‚ â”‚ Answer: ${answer}                           â”‚   â”‚
â”‚ â”‚                                             â”‚   â”‚
â”‚ â”‚ Question: 2+2ã¯?                           â”‚   â”‚
â”‚ â”‚ Answer:                                     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â”‚ ã“ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ trainset ã‚’å®Ÿè¡Œ                 â”‚
â”‚ â€¢ Example 1: 2+2 â†’ æœŸå¾…å€¤: 4                    â”‚
â”‚ â€¢ Example 2: 3Ã—5 â†’ æœŸå¾…å€¤: 15                   â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ•ã‚§ãƒ¼ã‚º2: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚ BootstrapFewShotç­‰ã«ã‚ˆã‚Š:                         â”‚
â”‚ 1. æˆåŠŸã—ãŸãƒ‡ãƒ¢ã‚’ç‰¹å®š                             â”‚
â”‚ 2. ãã‚Œã‚‰ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ                        â”‚
â”‚ 3. æ–°ã—ã„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç”Ÿæˆ             â”‚
â”‚                                                     â”‚
â”‚ æœ€é©åŒ–å¾Œã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ You are an expert at math problems...      â”‚   â”‚
â”‚ â”‚ Answer clearly and concisely.              â”‚   â”‚
â”‚ â”‚                                             â”‚   â”‚
â”‚ â”‚ Follow the examples below:                  â”‚   â”‚
â”‚ â”‚                                             â”‚   â”‚
â”‚ â”‚ ã€ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1ã€‘                   â”‚   â”‚
â”‚ â”‚ Question: 2+2ã¯?                          â”‚   â”‚
â”‚ â”‚ Answer: 4                                   â”‚   â”‚
â”‚ â”‚                                             â”‚   â”‚
â”‚ â”‚ ã€ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³2ã€‘                   â”‚   â”‚
â”‚ â”‚ Question: 3Ã—5ã¯?                          â”‚   â”‚
â”‚ â”‚ Answer: 15                                  â”‚   â”‚
â”‚ â”‚                                             â”‚   â”‚
â”‚ â”‚ Question: ${question}                       â”‚   â”‚
â”‚ â”‚ Answer: ${answer}                           â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â”‚ [è¤‡æ•°å›ã®APIå‘¼ã³å‡ºã—ã§æœ€é©åŒ– - Nå›]              â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ•ã‚§ãƒ¼ã‚º3: æœ€é©åŒ–ã•ã‚ŒãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚ æ”¹å–„ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ:                 â”‚
â”‚ â€¢ ã‚ˆã‚Šè©³ç´°ãªæŒ‡ç¤º                                 â”‚
â”‚ â€¢ æˆåŠŸã—ãŸãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³                   â”‚
â”‚ â€¢ å„ªã‚ŒãŸä¾‹ã‹ã‚‰å­¦ç¿’                              â”‚
â”‚                                                     â”‚
â”‚ ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§æ–°ã—ã„è³ªå•ã‚’å®Ÿè¡Œ:                â”‚
â”‚ Question: 10+5ã¯?                              â”‚
â”‚ â†’ ã‚ˆã‚Šæ­£ç¢ºãªå›ç­”ãŒå¾—ã‚‰ã‚Œã‚‹ç¢ºç‡ãŒå‘ä¸Š             â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š çµ±è¨ˆ:
  â€¢ åˆæœŸAPIå‘¼ã³å‡ºã—: 1å›ï¼ˆãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼‰
  â€¢ æœ€é©åŒ–ãƒ•ã‚§ãƒ¼ã‚ºã®APIå‘¼ã³å‡ºã—: Nå›ï¼ˆæœ€é©åŒ–è©¦è¡Œï¼‰
  â€¢ Signatureå€‹æ•°: 1å€‹
  â€¢ è¤‡é›‘åº¦: â­â­â­â­â­ (æœ€ã‚‚è¤‡é›‘)
  â€¢ å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰: ãƒ¡ã‚¿ãƒ¬ãƒ™ãƒ«ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè‡ªä½“ã‚’æ”¹å–„ï¼‰

ğŸ’¡ ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯æœ€é©åŒ–ã®"æ¦‚å¿µ"ã‚’ç¤ºã—ã¦ã„ã¾ã™
   å®Ÿéš›ã®æœ€é©åŒ–ã«ã¯ BootstrapFewShot ãªã©ã®
   ãƒ†ãƒ¬ãƒ—ãƒ­ãƒ³ãƒ—ã‚¿ãƒ¼ï¼ˆoptimizerï¼‰ãŒå¿…è¦ã§ã™ã€‚
"""

print(optimization_flow)

# ========== æ¯”è¼ƒè¡¨ ==========
print("\n" + "=" * 80)
print("3ã¤ã®ãƒ‡ãƒ¢ã®æ¯”è¼ƒ")
print("=" * 80)

comparison = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é …ç›®             â”‚ ãƒ‡ãƒ¢1:Simple â”‚ ãƒ‡ãƒ¢2:Pipeline   â”‚ ãƒ‡ãƒ¢3:æœ€é©åŒ–     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ APIå‘¼ã³å‡ºã—æ•°    â”‚ 1å›          â”‚ 2å›              â”‚ Nå›              â”‚
â”‚ Signatureæ•°      â”‚ 1å€‹          â”‚ 2å€‹              â”‚ 1å€‹              â”‚
â”‚ å‡¦ç†æ®µéš         â”‚ 5ã‚¹ãƒ†ãƒƒãƒ—    â”‚ 2ã‚¹ãƒ†ãƒƒãƒ—Ã—2      â”‚ 3ãƒ•ã‚§ãƒ¼ã‚º        â”‚
â”‚ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼     â”‚ å˜ç´”         â”‚ ç·šå½¢ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ â”‚ ãƒ¡ã‚¿ãƒ¬ãƒ™ãƒ«       â”‚
â”‚ è¤‡é›‘åº¦           â”‚ ä½           â”‚ ä¸­               â”‚ é«˜               â”‚
â”‚ å®Ÿè¡Œæ™‚é–“         â”‚ çŸ­           â”‚ ä¸­               â”‚ é•·               â”‚
â”‚ ã‚³ã‚¹ãƒˆ(API)      â”‚ ä½           â”‚ ä¸­               â”‚ é«˜               â”‚
â”‚ å‡ºåŠ›å‹           â”‚ å˜ä¸€å€¤       â”‚ è¤‡æ•°å€¤           â”‚ ãƒ—ãƒ­ã‚°ãƒ©ãƒ        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹     â”‚ å˜ç´”ãªè³ªå•å¿œç­”â”‚ è¤‡æ•°ã‚¹ãƒ†ãƒƒãƒ—å‡¦ç† â”‚ ç²¾åº¦å‘ä¸ŠãŒå¿…è¦   â”‚
â”‚                  â”‚              â”‚ (è¤‡é›‘ãªåˆ†æ)     â”‚ (æœ¬ç•ªç’°å¢ƒå‘ã‘)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""

print(comparison)

# ========== å…¨ä½“ãƒ•ãƒ­ãƒ¼å›³ ==========
print("\n" + "=" * 80)
print("å…¨ä½“ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡¦ç†ãƒ•ãƒ­ãƒ¼")
print("=" * 80)

overall_flow = """
ã€DSPyãƒ—ãƒ­ã‚°ãƒ©ãƒ å…¨ä½“ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã€‘

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¼ãƒ‰ (sample_program.py)
  â”œâ”€ ãƒ‡ãƒ¢1: qa = dspy.Predict("question -> answer")
  â”‚                    â†“
  â”‚         [1ã¤ã®APIå‘¼ã³å‡ºã—]
  â”‚                    â†“
  â”‚         Prediction(answer="...")
  â”‚
  â”œâ”€ ãƒ‡ãƒ¢2: pipeline.forward(question)
  â”‚         Step 1: extract_points()
  â”‚                    â†“
  â”‚         [1ã¤ã®APIå‘¼ã³å‡ºã—]
  â”‚                    â†“
  â”‚         Step 2: generate_answer()
  â”‚                    â†“
  â”‚         [1ã¤ã®APIå‘¼ã³å‡ºã—]
  â”‚                    â†“
  â”‚         Prediction(...)
  â”‚
  â””â”€ ãƒ‡ãƒ¢3: optimizer.compile(program, trainset)
           è¤‡æ•°å›ã®è©¦è¡Œãƒ»è©•ä¾¡
                    â†“
           æ”¹å–„ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
                    â†“
           æœ€é©åŒ–ã•ã‚ŒãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ 

ã€APIå‘¼ã³å‡ºã—ã®è©³ç´°ã€‘

ãƒ‡ãƒ¢1ã®æµã‚Œ:
  User Input â†’ Signature Parse â†’ Prompt Build â†’ API Call â†’ Parse Response â†’ Output
  
ãƒ‡ãƒ¢2ã®æµã‚Œ:
  User Input â†’ 
    Signature1 Parse â†’ Prompt Build â†’ API Call1 â†’ Parse Response1 â†’
    (ä¸­é–“å€¤) â†’
    Signature2 Parse â†’ Prompt Build â†’ API Call2 â†’ Parse Response2 â†’
  Output

ãƒ‡ãƒ¢3ã®æµã‚Œ:
  Program + TrainSet â†’ 
    (å¤šãã®APIå‘¼ã³å‡ºã—ã§è©¦è¡Œãƒ»è©•ä¾¡) â†’
    æ”¹å–„ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ â†’
    New Program

ã€APIå‘¼ã³å‡ºã—æ•°ã®åˆè¨ˆã€‘
  ãƒ‡ãƒ¢1: 1å›
  ãƒ‡ãƒ¢2: 2å›
  ãƒ‡ãƒ¢3: è¤‡æ•°å›ï¼ˆæœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ä¾å­˜ï¼‰
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  åˆè¨ˆ: 3å›ä»¥ä¸Šã®APIå‘¼ã³å‡ºã—
"""

print(overall_flow)

print("\n" + "=" * 80)
print("âœ… 3ã¤ã®ãƒ‡ãƒ¢ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæµã‚Œã®å¯è¦–åŒ–ãŒå®Œäº†ã—ã¾ã—ãŸ")
print("=" * 80)

print("\nğŸ“š è©³ç´°ã‚’çŸ¥ã‚‹ã«ã¯:")
print("  â€¢ sample_program.py: å®Ÿéš›ã®å®Ÿè£…")
print("  â€¢ prompt_flow_explanation.py: åŸºæœ¬çš„ãªãƒ•ãƒ­ãƒ¼")
print("  â€¢ prompt_content_detail.py: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹ã®è©³ç´°")
